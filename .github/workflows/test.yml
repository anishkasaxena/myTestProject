name: Packages cleanup
on:
    push:
      branches:
        - main
jobs:
  fetch-packages:
    runs-on: ubuntu-latest

    outputs:
      result: ${{ steps.step1.outputs.result }}
    steps:        
        - name: Debug
          id: step1
          run: |
            set -x
            result=$(curl -s -H "Authorization: token ${{ secrets.TOKEN }}" \
            "https://api.github.com/orgs/5ire-tech/packages?package_type=container"\
             | jq -r '.[] .name' | tr '\n' ',' | sed 's/,$//' | sed 's/^/[/;s/$/]/') 
             echo "$result<<EOF" >> $GITHUB_OUTPUT
             echo 'EOF' >> $GITHUB_OUTPUT   
                             

  use-matrix:
    needs: fetch-packages
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package: '[validator-backend,nominator-backend,esg-backend,explorer-api,explorer-write,esg-frontend,nominator-frontend,validator-frontend,explorer-frontend,esg-admin-frontend,explorer-evm-socket,explorer-evm-write,explorer-native-socket,explorer-evm-api,explorer-native-api,explorer-native-write]'    steps:

      - name: Delete Package
        run: | 
          echo "${{ matrix.package }}"
       







